# Description: CUPS - Common UNIX Printing System
# URL:         http://www.cups.org
# Maintainer:  Juergen Daubert, juergen dot daubert at t-online dot de
# Depends on:  libpng, libtiff, openssl

name=cups
version=1.4.1
release=1
source=(http://ftp.easysw.com/pub/cups/$version/$name-$version-source.tar.bz2 \
        cups-config.patch cups cups-st3332.patch)

build () {
    cd $name-$version

    patch -p1 -i $SRC/cups-st3332.patch
    patch -p1 -i $SRC/cups-config.patch

    ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --mandir=/usr/man \
                --localstatedir=/var \
                --with-docdir=/usr/share/cups/doc \
                --with-logdir=/var/log/cups \
                --with-dbusdir=/usr/etc/dbus-1 \
                --with-cups-user=daemon \
                --with-cups-group=lp \
                --with-languages="" \
                --without-{java,perl,php,python} \
                --enable-ssl \
                --enable-gnutls=no \
                --enable-openssl=yes \
                --enable-pam=no \
                --enable-pdftops=no \
                --enable-libusb=no

    make
    make BUILDROOT=$PKG install

    rm -r $PKG/etc/rc.d/*
    rm -r $PKG/usr/share/{icons,applications}
    chmod 0755 $PKG/var/{cache,spool}   
    chmod -R +w $PKG
 
    install -d $PKG/etc/ssl/{certs,keys}
    touch $PKG/etc/ssl/certs/cups.crt
    touch $PKG/etc/ssl/keys/cups.key
    chmod 0600 $PKG/etc/ssl/{keys/cups.key,certs/cups.crt}

    install -D -m 755 $SRC/cups $PKG/etc/rc.d/cups
}
