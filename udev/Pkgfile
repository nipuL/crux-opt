# Description: Userspace device management daemon
# URL: http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html
# Maintainer: Matt Housh, jaeger at morpheus dot net
# Depends on: hotplug

name=udev
version=085
release=1
source=(ftp://ftp.kernel.org/pub/linux/utils/kernel/hotplug/$name-$version.tar.bz2 \
	udev.rules start_udev)

build() {
	cd $name-$version
	sed -i -e 's/$(OPTIMIZATION)//' Makefile
	make \
		USE_KLIBC=false \
		USE_LOG=false \
		DEBUG=false \
		EXTRAS="extras/scsi_id extras/volume_id extras/ata_id extras/run_directory extras/usb_id extras/floppy extras/cdrom_id extras/firmware" \
		udevdir="/dev" \
		mandir="/usr/man" \
		DESTDIR=$PKG all install
	# udev, udevsend, udevstart need to be installed manually now
	install -m 0755 udev{,send,start} $PKG/sbin/
	# man pages
	install -m 0644 udev{send,start}.8 $PKG/usr/man/man8/
	install -m 0644 $SRC/udev.rules \
		$PKG/etc/udev/rules.d/50-udev.rules
	install extras/raid-devfs.sh $PKG/lib/udev/
	install -D -m 0755 $SRC/start_udev $PKG/sbin/start_udev
	install extras/path_id extras/floppy/create_floppy_devices \
		extras/firmware/firmware_helper $PKG/sbin/
	mkdir -p $PKG/etc/hotplug.d/default
	ln -s /sbin/udevsend $PKG/etc/hotplug.d/default/10-udev.hotplug
	mkdir -p $PKG/etc/dev.d/{default,net}
	install extras/run_directory/dev.d/net/hotplug.dev $PKG/etc/dev.d/net/
	mkdir -p $PKG/lib/udev/devices
	mknod -m 0666 $PKG/lib/udev/devices/null c 1 3
	mknod -m 0666 $PKG/lib/udev/devices/zero c 1 5
	mknod -m 0600 $PKG/lib/udev/devices/console c 5 1
}
