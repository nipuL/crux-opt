diff -Nru mdadm-2.5.orig/Makefile mdadm-2.5/Makefile
--- mdadm-2.5.orig/Makefile	2006-06-15 12:49:16.000000000 +0200
+++ mdadm-2.5/Makefile	2006-06-15 12:52:54.000000000 +0200
@@ -32,7 +32,9 @@
 TCC = tcc
 UCLIBC_GCC = $(shell for nm in i386-uclibc-linux-gcc i386-uclibc-gcc; do which $$nm > /dev/null && { echo $$nm ; exit; } ; done; echo false No uclibc found )
 DIET_GCC = diet gcc
-LDLIBS=-lssl
+ifeq ($(USE_SSL),1)
+LDLIBS=-lcrypto
+endif
 
 KLIBC=/home/src/klibc/klibc-0.77
 
@@ -72,6 +74,11 @@
 	Create.c Detail.c Examine.c Grow.c Monitor.c dlink.c Kill.c Query.c \
 	mdopen.c super0.c super1.c bitmap.c restripe.c sysfs.c
 
+ifneq ($(USE_SSL),1)
+OBJS += SHA1.o sha1.o
+SRCS += SHA1.c sha1.c
+endif
+
 ASSEMBLE_SRCS := mdassemble.c Assemble.c config.c dlink.c util.c super0.c super1.c
 ASSEMBLE_FLAGS:= -DMDASSEMBLE
 ifdef MDASSEMBLE_AUTO
