# Description: Simple Authentication and Security Layer
# URL: http://asg.web.cmu.edu/sasl/sasl-library.html
# Maintainer: Simon Gloﬂner, viper at hometux dot de
# Packager: Daniel Mueller, daniel at danm dot de
# Depends on: db, openssl

name=cyrus-sasl
version=2.1.21
release=4
source=(http://ftp.andrew.cmu.edu/pub/cyrus-mail/$name-$version.tar.gz \
	$name-$version-crypt.patch \
	$name-$version-gcc4.patch \
        saslauthd)

build(){
	cd $name-$version

        # fix the crypt function
	patch -p0 < $SRC/$name-$version-crypt.patch
	# necessary to compile cyrus-sasl with gcc4
	patch -p0 < $SRC/$name-$version-gcc4.patch

	./configure \
	    --prefix=/usr \
	    --sysconfdir=/etc/sasl \
	    --with-plugindir=/usr/lib/sasl2 \
	    --with-saslauthd=/var/sasl/saslauthd \
	    --with-dbpath=/etc/sasl/sasldb2 \
	    --with-dblib=berkeley \
	    --with-bdb-incdir=/usr/include \
	    --with-bdb-libdir=/usr/lib \
	    --with-openssl=/usr \
            --enable-login \
            --enable-cram \
            --enable-digest \
	    --enable-shared 
	make
	make DESTDIR=$PKG install

	mkdir -p \
	    $PKG/usr/lib/sasl2 \
	    $PKG/var/sasl/saslauthd \
	    $PKG/etc/rc.d \
	    $PKG/usr/man/man8 
	
	install -m 755 $SRC/saslauthd $PKG/etc/rc.d
	mv $PKG/usr/man/cat8/*.8 $PKG/usr/man/man8

	rmdir $PKG/usr/man/cat8
}
