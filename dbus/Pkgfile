# Description: A message bus system
# URL: http://freedesktop.org/wiki/Software_2fdbus
# Packager: Matt Housh, jaeger at crux dot nu
# Maintainer: Brett Goulder, predatorfreak at dcaf-security dot org
# Depends on: expat

name=dbus
version=1.1.20
release=2
source=(http://dbus.freedesktop.org/releases/dbus/$name-$version.tar.gz \
rc.dbus 30-dbus.launch \
$name-$version-fix-build.patch)

build() {
	cd $name-$version
	patch -p1 -i $SRC/$name-$version-fix-build.patch
	./configure --prefix=/usr \
		--with-dbus-daemondir=/usr/sbin \
		--localstatedir=/var \
		--libexecdir=/usr/lib/dbus \
		--mandir=/usr/man \
		--disable-static \
		--with-dbus-user=messagebus \
		--with-xml=expat \
		--with-system-pid-file=/var/run/$name/$name.pid
	make
	make DESTDIR=$PKG install
	install -D -m 0755 $SRC/rc.dbus $PKG/etc/rc.d/dbus
	install -D -m 0755 $SRC/30-dbus.launch \
		$PKG/etc/X11/xinit/xinitrc.d/30-dbus.launch
}
