# Description: The Open Group X Window System
# Maintainer:  Jürgen Daubert, juergen dot daubert at t-online dot de
# Packager:    Daniel Mueller, daniel at danm dot de
# URL:         http://xorg.freedesktop.org/wiki/
# Depends on:  libpng, fontconfig
#
# Nice to have: libtxc_dxtn

name=x11
version=6.9.0
release=3
source=(http://ftp.x.org/pub/X11R${version}/src-single/X11R${version}-src.tar.bz2 \
	$name-$version-xterm256.patch $name-$version-linux_config.patch \
        http://xorg.freedesktop.org/releases/X11R${version}/patches/${name}r${version}-geteuid.diff \
        xdm host.def)

build() {
    cd xc
    patch -p1 < $SRC/$name-$version-xterm256.patch
    patch -p1 < $SRC/$name-$version-linux_config.patch
    patch -p0 < $SRC/${name}r${version}-geteuid.diff

    sed "s/#CFLAGS#/$CFLAGS/" $SRC/host.def > config/cf/host.def
    make World
    make DESTDIR=$PKG install
    make DESTDIR=$PKG install.man

    rm -rf $PKG/usr/X11R6/lib/X11/doc \
	   $PKG/usr/X11R6/src \
	   $PKG/usr/include/GL \
	   $PKG/etc/rc.d \
	   $PKG/usr/lib 

    install -D -m 755 $SRC/xdm $PKG/etc/rc.d/xdm
    ln -s ../X11R6/include/X11 $PKG/usr/include/X11
    ln -s ../X11R6/include/GL $PKG/usr/include/GL
    touch $PKG/usr/X11R6/man/whatis

    # Fix a bug with XDM, otherwise you may not be able to
    # type your login-info.
    sed -i -e 's|:0 local.*|& vt7|' $PKG/etc/X11/xdm/Xservers

    mkdir -p $PKG/usr/lib
    mv $PKG/usr/X11R6/lib/pkgconfig $PKG/usr/lib
    mv $PKG/etc/{init.d,profile.d} $PKG/etc/X11

    # Remove buggy xorgcfg
    rm $PKG/usr/X11R6/{bin/xorgcfg,man/man1/xorgcfg.1x}

    chmod -R +w $PKG
}
