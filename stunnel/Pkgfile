# $Id: Pkgfile,v 1.3 2005/11/06 19:44:23 victord Exp $
# Description: Stunnel wraps normal socket connections with SSL/TLS
# URL:         http://www.stunnel.org
# Maintainer:  Jürgen Daubert, juergen dot daubert at t-online dot de
# Depends on:  openssl zlib

name=stunnel
version=4.14
release=1
source=(http://www.stunnel.org/download/stunnel/src/$name-$version.tar.gz \
        $name.patch $name)

build () {
    cd $name-$version
    patch -p1 < $SRC/$name.patch
    ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --localstatedir=/var \
                --with-ssl=/usr \
                --with-tcp-wrappers \
                --enable-ipv6 \
                --enable-static=yes \
                --enable-shared=no
    make
    install -D -m 0755 src/stunnel $PKG/usr/sbin/stunnel
    install -D -m 0644 doc/stunnel.8 $PKG/usr/man/man8/stunnel.8
    install -D -m 0755 $SRC/$name  $PKG/etc/rc.d/$name
    install -m 0644 tools/stunnel.conf-sample $PKG/etc/stunnel.conf
    install -d $PKG/{var/run,etc/ssl/{certs,keys}}
    install -d -o nobody -g nobody $PKG/var/run/stunnel
    touch $PKG/etc/ssl/{certs/$name.crt,keys/$name.key}
}
