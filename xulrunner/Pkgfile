# Description: Mozilla Web Browser Component
# URL: http://www.mozilla.com/firefox/
# Maintainer: Tilman Sauerbeck, tilman at crux dot nu
# Arch Maintainer: Lucas Hazel, lucas at die dot net dot au
# Depends on: libidl, nss, gtk, perl, python, dbus-glib, alsa-lib

name=xulrunner
version=1.9.1.1
release=1
source=(http://releases.mozilla.org/pub/mozilla.org/firefox/releases/3.5.1/source/firefox-3.5.1-source.tar.bz2
        mozconfig $name.diff)

build() {
	export MOZ_CO_PROJECT="xulrunner"
	export XCFLAGS="$CFLAGS"

	cd mozilla-1.9.1

	patch -Np1 -i $SRC/$name.diff

	# make configure accept our version of sqlite
	sed -i -e 's/^SQLITE_VERSION=3.5.9$/SQLITE_VERSION=3.5/' configure

	sed -e "s/#CFLAGS#/$CFLAGS/g" \
	    -e "s/#MAKEFLAGS#/$MAKEFLAGS/g" \
	    $SRC/mozconfig > .mozconfig

	./configure
	make 
	make DESTDIR=$PKG install

	install -d $PKG/etc/ld.so.conf.d
	echo "/usr/lib/$name-$version" > $PKG/etc/ld.so.conf.d/$name.conf
}
