# Description: Graphics utilities for the KDE integrated X11 desktop
# URL: http://www.kde.org
# Maintainer: sten, nick dot steeves at shaw dot ca
# Packager: 
# Depends on: kdebase, imagemagick, tetex, fribidi, sane, libgphoto2, freeglut, poppler

name=kdegraphics
version=3.5.1
release=2
source=(http://download.kde.org/stable/3.5.1/src/$name-$version.tar.bz2
    ftp://ftp.kde.org/pub/kde/security_patches/post-3.5.1-kdegraphics-CVE-2006-0301.diff
    svgdisplay.desktop kpdf.patch)

build() {
    cd $name-$version
    patch -d kpdf -i $SRC/kpdf.patch
    patch -p0 -i $SRC/post-3.5.1-kdegraphics-CVE-2006-0301.diff

    # Nvidia hack
    NVIDIAINCLUDES=/usr/include/nvidia
    if [ -d $NVIDIAINCLUDES ]; then
        sed -i -e "s|^DEFS.*|DEFS = -I$NVIDIAINCLUDES @DEFS@|g" kpovmodeler/Makefile.in
    fi

    ./configure	--prefix=/usr \
        --enable-multithreaded-kpdf \
        --disable-dependency-tracking \
        --disable-debug \
        --enable-final
    make
    make DESTDIR=$PKG install
    rm -rf $PKG/usr/share/doc
    mkdir -p $PKG/usr/share/texmf/tex/kdvi
    cp doc/kdvi/*.sty $PKG/usr/share/texmf/tex/kdvi
    install -D ../svgdisplay.desktop \
    $PKG/usr/share/applnk/.hidden/svgdisplay.desktop
}
