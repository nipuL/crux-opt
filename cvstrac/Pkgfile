# Description: Bug tracking system for Subversion and CVS with integrated Wiki and repository browser
# URL:         http://www.cvstrac.org
# Maintainer:  Jürgen Daubert, juergen dot daubert at t-online dot de
# Depends on:  sqlite, rcs

name=cvstrac
version=1.2.1
release=1
source=(http://www.cvstrac.org/$name-$version.tar.gz \
        cvstrac_cgi cvstracd)

build () {
    cd $name-$version
    
    sed "/^SRCDIR/s/=.*$/=\./; s/-O[02]/$CFLAGS/ " linux-gcc.mk > Makefile
    make
    chmod 777 .
    su nobody -c "./cvstrac init . MyProject"
    
    install -D -m 755 cvstrac $PKG/usr/bin/cvstrac
    ln -s cvstrac $PKG/usr/bin/svntrac
    
    install -d $PKG/var/lib
    install -d -o nobody -g nobody $PKG/var/lib/cvstrac
    install -m 644 -o nobody -g nobody MyProject.db $PKG/var/lib/cvstrac
    
    install -D -m 755 ../cvstrac_cgi $PKG/var/www/cgi-bin/cvstrac.cgi
    install -D -m 755 ../cvstracd $PKG/etc/rc.d/cvstrac
}
