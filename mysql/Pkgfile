# Description: SQL database server
# URL:         http://www.mysql.com
# Maintainer:  Juergen Daubert, juergen dot daubert at t-online dot de
# Arch Maintainer: Lucas Hazel, lucas at die dot net dot au
# Depends on:  ncurses readline zlib

name=mysql
version=5.1.37
release=1
source=(http://mirror.switch.ch/mirror/mysql/Downloads/MySQL-5.1/$name-$version.tar.gz \
        my.cnf mysqld)

build () {
    cd $name-$version

    ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --libexecdir=/usr/sbin \
                --localstatedir=/var/lib \
                --mandir=/usr/man \
                --enable-assembler \
                --enable-thread-safe-client \
                --without-{readline,debug,docs} \
                --with-ssl \
                --with-plugins=myisam,innobase
    
    make
    make DESTDIR=$PKG install

    rm -r $PKG/usr/{mysql-test,sql-bench}
    rm $PKG/usr/share/mysql/charsets/README
    find $PKG/usr/share/mysql/* -type d ! -name english ! -name charsets | xargs rm -rf {} \;

    install -d  $PKG/var/{lib,log}
    touch mysqld.log
    install -m 600 -o mysql -g mysql mysqld.log $PKG/var/log
    install -d -m 700 -o mysql -g mysql $PKG/var/lib/mysql
    install -D -m 755 $SRC/mysqld $PKG/etc/rc.d/mysqld
    install -m 600 $SRC/my.cnf $PKG/etc

    install -d $PKG/etc/ld.so.conf.d
    echo "/usr/lib/mysql" > $PKG/etc/ld.so.conf.d/mysql.conf
}
