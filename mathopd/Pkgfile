# Description: Very fast and highly configurable HTTP server
# URL:         http://www.mathopd.org/
# Maintainer:  Jürgen Daubert, juergen dot daubert at t-online dot de

name=mathopd
version=1.5p5
release=2
source=(http://www.mathopd.org/dist/$name-$version.tar.gz \
        http://jue.li/misc/dir_cgi/dir_cgi-1.0.tar.gz \        
        http://www.mathopd.org/doc/mathopd.8.gz \
        http://www.mathopd.org/doc/mathopd.conf.5.gz \
        mathopd.conf mathopd)

build () {
    cd $name-$version/src
    sed -i '37s/# //' Makefile
    make -e CPPFLAGS="-DHAVE_CRYPT_H -DHAVE_VFORK -DLINUX_SENDFILE -Wall"

    install -d $PKG/{var/log,etc/rc.d,usr/{bin,sbin,man/man{8,5}}}
    install -m 755 mathopd $PKG/usr/sbin
    install -m 644 $SRC/mathopd.conf $PKG/etc
    install -m 755 $SRC/mathopd $PKG/etc/rc.d
    install -m 644 $SRC/mathopd.8.gz $PKG/usr/man/man8
    install -m 644 $SRC/mathopd.conf.5.gz $PKG/usr/man/man5
    install -d -o nobody -g nobody $PKG/var/log/mathopd

    cd $SRC/dir_cgi-1.0
    make DESTDIR=$PKG install
}
