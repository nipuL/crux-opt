# Description: IMAP and POP3 server with ssl/ipv6 support, written with security primarily in mind
# URL:         http://dovecot.org
# Maintainer:  Jürgen Daubert, juergen dot daubert at t-online dot de
# Depends on:  openssl

name=dovecot
version=1.0.2
release=1
source=(http://dovecot.org/releases/$name-$version.tar.gz \
        dovecot-config.patch dovecot)

build () {
    cd $name-$version

    patch -p1 < $SRC/$name-config.patch
    ./configure --prefix=/usr \
                --libexecdir=/usr/lib \
                --sysconfdir=/etc \
                --localstatedir=/var \
                --with-moduledir=/usr/lib/dovecot/modules \
                --with-ioloop=epoll \
                --enable-ipv6 \
                --with-ssl=openssl \
                --with-pop3d
    make
    make DESTDIR=$PKG install

    rm -r $PKG/usr/{share,include}
    rm $PKG/etc/dovecot-{ldap,sql}-example.conf
    mv $PKG/etc/dovecot-example.conf $PKG/etc/dovecot.conf
    install -D -m 755 $SRC/dovecot $PKG/etc/rc.d/dovecot

    install -d $PKG/etc/ssl/{certs,keys}
    touch $PKG/etc/ssl/certs/dovecot.crt
    touch $PKG/etc/ssl/keys/dovecot.key
    chmod 0600 $PKG/etc/ssl/{keys/dovecot.key,certs/dovecot.crt}

    install -d $PKG/var/{run,lib}/dovecot
    install -d -m 0750 -o root -g dovecot $PKG/var/run/dovecot/login
    chmod 0750 $PKG/var/lib/dovecot
}
